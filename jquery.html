<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .red{
      color:red;
    }
  </style>
</head>
<body>
  
<div id="app">
  <div id="title"></div>


  <input type="text" id="input">
  <button id="btn">添加</button>

  <ul id="ul">
  </ul>
</div>
<script>
  
  let $ = window.$ = function(selector){
    return new jQuery(selector)
  }
  $.get = function(url, callback){
    let xhr = new XMLHttpRequest()
    xhr.open('GET', url)
    xhr.onload = function(){
      if(xhr.status === 200){
        callback(JSON.parse(xhr.response))
      }
    }
    xhr.send()
  }
  $.jsonp = function(url,callback){
    let callbackName = 'jsonp_callback_' + Math.random().toString().replace('.', '')
    window[callbackName] = function(data){
      callback(data)
      delete window[callbackName]
    }
    let script = document.createElement('script')
    script.src = url + '?callback=' + callbackName
    document.body.appendChild(script)
  }

  class jQuery{
    constructor(selector){
      this.selector = selector
      this.init(selector)
    }
    init(selector){
      if(typeof selector==='string'){
        this.elements = [...document.querySelectorAll(selector)]
      }else if(selector instanceof HTMLElement){
        this.elements = [selector]
      }else if(typeof selector==="function"){
        this.elements = []
        document.addEventListener('DOMContentLoaded', selector)
      }
    }
    html(str){
      if(str===undefined){
        return this.elements[0].innerHTML
      }else{
        this.elements.forEach(ele=>ele.innerHTML=str)
        return this
      }
    }
    append(child){
      if(typeof child === 'string'){
        this.elements.forEach(ele=>ele.innerHTML+=child)
      }else if(child instanceof jQuery){
        this.elements.forEach(ele=>ele.innerHTML+=child.html())
      }else if(child instanceof HTMLElement){
        this.elements.forEach(ele=>ele.appendChild(child))
      }
      return this
    }
    on(event, callback,useCapture=false){
      this.elements.forEach(ele=>ele.addEventListener(event, callback,useCapture))
      return this
    }
    css(attr, value){
      if(value===undefined){
        return this.elements[0].style[attr]
      }else{
        this.elements.forEach(ele=>ele.style[attr]=value)
      }
      return this
    }
    addClass(className){
      this.elements.forEach(ele=>ele.classList.add(className))
      return this
    }
    removeClass(className){
      this.elements.forEach(ele=>ele.classList.remove(className))
      return this
    }
    val(str){
      if(str===undefined){
        return this.elements[0].value
      }else{
        this.elements.forEach(ele=>ele.value=str)
        return this
      }
    }
  }

  $(function(){

    $.jsonp('http://localhost:24678/info', function(res){
      console.log(res)
      $('#title').html(res.title).addClass('red')
    })

    // $.get('http://localhost:24678/info', function(res){
    //   console.log(res)
    //   $('#title').html(res.title).addClass('red')
    // })
    // $('#title').html('<h1>hi</h1>').addClass('red')
    $('#btn').on('click', function(){
      let val = $('#input').val()
      $('#ul').append(`<li>${val}</li>`)
      $('#input').val('')
    })
  })
</script>
</body>
</html>